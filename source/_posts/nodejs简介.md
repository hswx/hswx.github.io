---
title: Nodejs简介
date: 2017-10-27 12:13:40
tags: "Node.js"
---
# 1 简介
  V8引擎：Chrome浏览器的js解释器
  
  Node.js：让JavaScript运行在服务器端的开发平台。与PHP、java等不同的是，Node.js的开发语言是JavaScript，运行在JavaScript的V8引擎上。Node.js不需要建设在任何服务器(Apache、Nginx)上，没有web容器。

# 2 特点
## 2.1 单线程

  在Java、PHP或者.net等服务器端语言中，会为每一个客户端连接创建一个新的线程。而每个线程需要耗费大约2MB内存。理论上，一个8GB内存的服务器可以同时连接的最大用户数为4000个左右。要让Web应用程序支持更多的用户，就需要增加服务器的数量，而Web应用程序的硬件成本当然就上升了。
  Node.js不为每个客户连接创建一个新的线程，而仅仅使用一个线程。当有用户连接了，就触发一个内部事件，通过非阻塞I/O、事件驱动机制，让Node.js程序宏观上也是并行的，在宏观上形成并发。使用Node.js，一个8GB内存的服务器，可以同时处理超过4万用户的连接，而且操作系统也不会有线程创建和销毁的额外开销。但也存在一定的问题，一旦某个连接造成线程的崩溃，整个服务也就崩溃了。

![](https://sfault-image.b0.upaiyun.com/528/256/528256591-578cd40ec0405)

![](https://sfault-image.b0.upaiyun.com/247/006/2470064245-578cd8e2b5a3e)

## 2.2 非阻塞I/O non-blocking I/O

  传统的单线程处理机制中，在进行I/O操作(读写数据库、文件等)的时候，整个线程都需要暂停下来，等待I/O操作返回结果之后才会继续执行。一个线程只能处理一个任务，要想进行多I/O的同步的操作，就必须开启多个线程，单个线程在等待I/O返回结果的时间内会一直处于阻塞状态，单个线程的利用率很低，整个程序的执行效率也因此而非常低下。
  
  Node.js中采用了非阻塞型I/O机制，在执行I/O操作的时候，将I/O操作的任务放在一边，继续执行后面的任务，这样一个线程永远在执行计算操作，该线程的利用率一直是100%。I/O操作会有一个回调函数，当I/O任务执行完毕，将以事件的形式通知I/O操作的线程，执行回调函数。在Node.js中，为了处理异步I/O，线程存在事件循环机制，不断检查有没有未处理的事件，依次予以处理。
  
## 2.3 事件驱动 event-driven
 
  在Node中，客户端请求建立连接，提交数据等行为，会触发相应的事件。在Node中，在一个时刻，只能执行一个事件回调函数，但是在执行一个事件回调函数的中途，可以转而处理其他事件（比如，又有新用户连接了），然后返回继续执行原事件的回调函数，这种处理机制，称为“事件环”机制。  
  Node.js底层是C++（V8也是C++写的）。底层代码中，近半数都用于事件队列、回调函数队列的构建。用事件驱动来完成服务器的任务调度，用一个线程，担负起了处理非常多的任务的使命。
  
# 3 应用场景
Node.js善于I/O，不善于计算。因为Node.js最擅长的就是任务调度，如果你的业务有很多的CPU计算，实际上也相当于这个计算阻塞了这个单线程，就不适合Node开发。当应用程序需要处理大量并发的I/O，而在向客户端发出响应之前，应用程序内部并不需要进行非常复杂的处理的时候，Node.js非常适合。Node.js也非常适合与web socket配合，开发长连接的实时交互应用程序。
